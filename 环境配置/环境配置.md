# 环境配置
## Ubuntu16.04 TensorFlow环境配置
1. 安装oracle版本jdk1.8  
	下载地址http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html	  
   解压到home目录子下,在.bashrc中配置java环境变量
   > export JAVA_HOME=~/jdk1.8.0_181  
   > export PATH=$JAVA_HOME/bin:$PATH  
   > export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar  
2. 安装Python3及tensorflow依赖包  
        sudo apt-get install python3.5  
	sudo apt-get install python3-pip python3-dev python3-numpy swig  
	pip3 install protobuf mock  
    注意：Ubuntu系统中，python默认版本为2.7版本，且系统很多软件依赖与python2.7,不能将python默认版本修改为python，所以使用python3命令来使用python3，使用pip3来管理python软件包。  
3. 安装cuda和cudnn  
cuda下载地址：https://developer.nvidia.com/cuda-90-download-archive?target_os=Linux&target_arch=x86_64&target_distro=Ubuntu&target_version=1604&target_type=deblocal  
cudnn下载地址：https://developer.nvidia.com/rdp/cudnn-archive    
安装cuda：  
> sudo dpkg -i cuda-repo-ubuntu1604-9-0-local_9.0.176-1_amd64.deb  
> sudo apt-key add /var/cuda-repo-9-0-local/7fa2af80.pub  
> sudo apt-get update  
> sudo apt-get install cuda  
> 安装cudnn:   
> sudo dpkg -i libcudnn7_7.0.5.15-1+cuda9.0_amd64.deb  
> sudo dpkg -i libcudnn7-dev_7.0.5.15-1+cuda9.0_amd64.deb  

> 注意：cuda安装9.0版本，cudnn安装7.0版本（cuDNN v7.0.5 Runtime Library for Ubuntu16.04 (Deb)和cuDNN v7.0.5 Developer Library for Ubuntu16.04 (Deb)）  
4. 安装tensorflow  
pip3 install --user tensorflow-gpu==1.8.0   
5. 测试tensorflow是否安装成功  
将一下内容写入到test.py文件  
’‘’
import tensorflow as tf  
hello = tf.constant('Hello, TensorFlow!')  
sess = tf.Session()  
print(sess.run(hello))  
‘’‘  
使用python3 test.py命令测试是否可以正常运行  
正常运行输出为：  
> 2018-09-04 15:30:15.876998: I tensorflow/core/platform/cpu_feature_guard.cc:140] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2018-09-04 15:30:18.216777: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:898] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2018-09-04 15:30:18.217852: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1356] Found device 0 with properties: 
name: GeForce GTX 1060 major: 6 minor: 1 memoryClockRate(GHz): 1.6705
pciBusID: 0000:01:00.0
totalMemory: 5.93GiB freeMemory: 5.86GiB
2018-09-04 15:30:18.217914: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1435] Adding visible gpu devices: 0
2018-09-04 15:30:26.699610: I tensorflow/core/common_runtime/gpu/gpu_device.cc:923] Device interconnect StreamExecutor with strength 1 edge matrix:
2018-09-04 15:30:26.699689: I tensorflow/core/common_runtime/gpu/gpu_device.cc:929]      0 
2018-09-04 15:30:26.699711: I tensorflow/core/common_runtime/gpu/gpu_device.cc:942] 0:   N 
2018-09-04 15:30:26.729460: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1053] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 5641 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1060, pci bus id: 0000:01:00.0, compute capability: 6.1)
b'Hello, TensorFlow!'  

## 源码安装
1. 配置上面步骤1-3
2. 安装Bazel	
	源码安装  
	$ git clone https://github.com/bazelbuild/bazel.git  
	$ cd bazel  
	$ git checkout tags/0.1.0  
	$ ./compile.sh  
	将执行路径 output/bazel 添加到 $PATH 环境变量中  

	release安装  
	https://github.com/bazelbuild/bazel/releases  
	chmod +x PATH_TO_INSTALL.SH  
	./PATH_TO_INSTALL.SH --user  
	将export PATH=$PATH:/home/user/bin加入到.bashrc  
3. 克隆TensorFlow仓库  
	git clone --recurse-submodules https://github.com/tensorflow/tensorflow    
	--recurse-submodules 参数是必须得, 用于获取 TesorFlow 依赖的 protobuf 库.   
4. android sdk和NDK下载  
	https://developer.android.google.cn/studio/#downloads  
	https://developer.android.google.cn/ndk/downloads/  
5. 编译TensorFlow  
	$ bazel build -c opt //tensorflow/tools/pip_package:build_pip_package  
	$ bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg  
	.whl 文件的实际名字与你所使用的平台有关	  
	$ pip install /tmp/tensorflow_pkg/tensorflow-0.5.0-cp27-none-linux_x86_64.whl  
6. 常见错误  
	status 4 是内存不足的问题，只需要增加swap空间即可  
	Ubuntu下增加swap空间的命令如下：  
	生成swap镜像文件  
	sudo dd if=/dev/zero of=/mnt/1024Mb.swap bs=1M count=1024  
	对该镜像文件格式化  
	sudo mkswap /mnt/1024Mb.swap  
	挂载该镜像文件  
	sudo swapon /mnt/1024Mb.swap  
	至此，使用free -m 即可查看到swap空间已经增加成功。  


# F&Q
## 错误1
”“”Traceback (most recent call last):  
  File "/usr/bin/pip3", line 9, in <module>  
    from pip import main  
ImportError: cannot import name 'main'   “”“
'''将/usr/bin/pip3中的  
from pip import main  
if __name__ == '__main__':  
    sys.exit(main())  
修改为：  
from pip import __main__  
if __name__ == '__main__':  
    sys.exit(__main__._main())  ‘’‘

## 错误2
“”“
Traceback (most recent call last):   
  File "/home/zack/.local/lib/python3.5/site-packages/tensorflow/python/pywrap_tensorflow.py", line 58, in <module>  
    from tensorflow.python.pywrap_tensorflow_internal import *  
  File "/home/zack/.local/lib/python3.5/site-packages/tensorflow/python/pywrap_tensorflow_internal.py", line 28, in <module> 
    _pywrap_tensorflow_internal = swig_import_helper()  
  File "/home/zack/.local/lib/python3.5/site-packages/tensorflow/python/pywrap_tensorflow_internal.py", line 24, in swig_import_helper  
    _mod = imp.load_module('_pywrap_tensorflow_internal', fp, pathname, description)  
  File "/usr/lib/python3.5/imp.py", line 242, in load_module  
    return load_dynamic(name, filename, file)  
  File "/usr/lib/python3.5/imp.py", line 342, in load_dynamic  
    return _load(spec)  
ImportError: libcublas.so.9.0: cannot open shared object file: No such file or directory
”“”
“”“
使用的为GPU版本，未安装cuda和cudnn
参考上面步骤安装cuda和cudnn
”“”

## 错误3
status 4 是内存不足的问题，只需要增加swap空间即可  
Ubuntu下增加swap空间的命令如下：  
生成swap镜像文件  
sudo dd if=/dev/zero of=/mnt/1024Mb.swap bs=1M count=1024  
对该镜像文件格式化  
sudo mkswap /mnt/1024Mb.swap  
挂载该镜像文件  
sudo swapon /mnt/1024Mb.swap  
至此，使用free -m 即可查看到swap空间已经增加成功。


参考：http://www.tensorfly.cn/tfdoc/get_started/os_setup.html
